# ES Sync Gateway Service (Rust) 
Cross-Cloud Elasticsearch (Self-Hosted) to AWS Elasticsearch Doc Indexing Sync Service using Rust, NATS Jetstream and Firecracker VMM


## Architectural Workflow

```shell
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                              PROPOSED: 4-STEP NATS STREAMING PIPELINE                               │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────────────────────┐              ┌──────────────────────────────────────┐
    │         GCP eu-west-1                │              │         AWS eu-north-1               │
    │                                      │              │                                      │
    │  ┌─────────────┐                     │              │                     ┌─────────────┐  │
    │  │   Iconik    │                     │              │                     │   Iconik    │  │
    │  │  Workload   │                     │              │                     │  Workload   │  │
    │  └──────┬──────┘                     │              │                     └─────────────┘  │
    │         │ 1. API Write               │              │                                      │
    │         ▼                            │              │                                      │
    │  ┌─────────────┐                     │              │                                      │
    │  │ Dual Write  │                     │              │                                      │
    │  │   Proxy     │                     │              │                                      │
    │  └──┬──────┬───┘                     │              │                                      │
    │     │      │                         │              │                                      │
    │     │ Sync │                         │              │                                      │
    │     ▼      │                         │              │                                      │
    │  ┌─────┐   │                         │              │                                      │
    │  │ C*  │   │ 2. Change Event         │              │                                      │
    │  └──┬──┘   │                         │              │                                      │
    │     │      │                         │              │                                      │
    │     │ Read │                         │              │                                      │
    │     ▼      ▼                         │              │                                      │
    │  ┌──────────────┐                    │              │                                      │
    │  │ ES-WATCHER   │ ◄─── Rust Binary   │              │                                      │
    │  |(es-sync-gtwy │      Sidecar       │              │                                      │
    │  └──────┬───────┘                    │              │                                      │
    │         │                            │              │                                      │
    │         │ 3. NATS Publish            │              │                                      │
    │         │    (JetStream)             │              │                                      │
    │         ▼                            │              │                                      │
    │     ════════════════════════════════════════════════════════════════════                   │
    │                                      │              │                                      │
    └──────────────────────────────────────┘              └──────────────────────────────────────┘
                                           │              │
                                           ▼              ▼
                              ┌─────────────────────────────────────────┐
                              │                                         │
                              │    ┌─────────────────────────────────┐  │
                              │    │     AWS FIRECRACKER microVM     │  │
                              │    │                                 │  │
                              │    │  ┌───────────────────────────┐  │  │
                              │    │  │      NATS-BRIDGE          │  │  │
                              │    │  │      (es-sync-gateway)    │  │  │
                              │    │  │                           │  │  │
                              │    │  │  ┌─────────────────────┐  │  │  │
                              │    │  │  │  Subject Filtering  │  │  │  │
                              │    │  │  │  ─────────────────  │  │  │  │
                              │    │  │  │  • es.iconik.assets │  │  │  │
                              │    │  │  │  • es.iconik.meta   │  │  │  │
                              │    │  │  │  • es.iconik.users  │  │  │  │
                              │    │  │  │  ✗ es.iconik.logs   │  │  │  │
                              │    │  │  │  ✗ es.iconik.temp   │  │  │  │
                              │    │  │  └─────────────────────┘  │  │  │
                              │    │  │                           │  │  │
                              │    │  │  ┌─────────────────────┐  │  │  │
                              │    │  │  │  Transform/Enrich   │  │  │  │
                              │    │  │  └─────────────────────┘  │  │  │
                              │    │  │                           │  │  │
                              │    │  └───────────────────────────┘  │  │
                              │    │                                 │  │
                              │    │  Memory: 128MB | CPU: 0.5 vCPU  │  │
                              │    │  Cold Start: <125ms             │  │
                              │    │                                 │  │
                              │    └─────────────────────────────────┘  │
                              │                                         │
                              │              NATS JetStream             │
                              │         (Cross-Cloud Replication)       │
                              │                                         │
                              └─────────────────────────────────────────┘
                                           │              │
                                           │              │
    ┌──────────────────────────────────────┘              └──────────────────────────────────────┐
    │                                      │              │                                      │
    │         GCP eu-west-1                │              │         AWS eu-north-1               │
    │                                      │              │                                      │
    │     ════════════════════════════════════════════════════════════════════                   │
    │                                      │              │         │                            │
    │                                      │              │         │ 4. NATS Subscribe          │
    │                                      │              │         │    (Filtered Stream)       │
    │                                      │              │         ▼                            │
    │                                      │              │  ┌──────────────┐                    │
    │                                      │              │  │  ES-WRITER   │ ◄─── Rust Binary   │
    │                                      │              │  │  (es-sync-gateway) │      Sidecar │
    │                                      │              │  └──────┬───────┘                    │
    │                                      │              │         │                            │
    │     ┌──────────────┐                 │              │         │ Bulk Index                 │
    │     │Elasticsearch │                 │              │         ▼                            │
    │     │    (GCP)     │                 │              │  ┌──────────────┐                    │
    │     └──────────────┘                 │              │  │Elasticsearch │                    │
    │                                      │              │  │    (AWS)     │                    │
    │                                      │              │  └──────────────┘                    │
    │                                      │              │                                      │
    └──────────────────────────────────────┘              └──────────────────────────────────────┘

    Components: 3 (single binary) | Queue Hops: 1 | Latency: <10ms | Language: Rust
```
